<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Expense Tracker Project</title>
</head>

<body>

    <div class="container mt-5">
        <h2>Add New Expense</h2>
        <form id="expenseForm">
            <div class="form-group">
                <label for="amount">Amount$:</label>
                <input type="number" class="form-control" id="amount" required>
            </div>
            <div class="form-group">
                <label for="category">Category:</label>
                <select class="form-control" id="category" required>
                    <option value="food">Food</option>
                    <option value="transportation">Transportation</option>
                    <option value="entertainment">Entertainment</option>
                    <!-- Add other categories  if you want -->
                </select>
            </div>
            <div class="form-group">
                <label for="date">Date:</label>
                <input type="date" class="form-control" id="date" required>
            </div>
            <div class="form-group">
                <label for="description">Description:</label>
                <textarea class="form-control" id="description" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Add Expense</button>
        </form>
    </div>

    <div class="container mt-4">
        <h2>Expense Summary</h2>
        <div class="row">
            <!-- Pie chart -->
            <div class="col-md-6">
                <canvas id="expenseCategoryChart" width="300" height="300"></canvas>
            </div>
            <!-- Bar chart -->
            <div class="col-md-6">
                <canvas id="expenseMonthChart" width="300" height="300"></canvas>
            </div>
        </div>
    </div>

    <div class="container mt-5">
        <h2>Expense List</h2>
        <table class="table" id="expenseList">
            <thead>
                <tr>
                    <th>Amount$</th>
                    <th>Category</th>
                    <th>Date</th>
                    <th>Description</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <!-- Modal for editing expenses -->
    <div class="modal fade" id="editExpenseModal" tabindex="-1" aria-labelledby="editExpenseModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editExpenseModalLabel">Edit Expense</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editExpenseForm">
                        <div class="form-group">
                            <label for="editAmount">Amount$:</label>
                            <input type="number" class="form-control" id="editAmount" required>
                        </div>
                        <div class="form-group">
                            <label for="editCategory">Category:</label>
                            <select class="form-control" id="editCategory" required>
                                <option value="food">Food</option>
                                <option value="transportation">Transportation</option>
                                <option value="entertainment">Entertainment</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editDate">Date:</label>
                            <input type="date" class="form-control" id="editDate" required>
                        </div>
                        <div class="form-group">
                            <label for="editDescription">Description:</label>
                            <textarea class="form-control" id="editDescription" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        let expenses = [];
        let editingIndex = -1;
        let expenseCategoryChart = null;
        let expenseMonthChart = null;

        // Listen for form submission
        document.getElementById('expenseForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const amount = document.getElementById('amount').value;
            const category = document.getElementById('category').value;
            const date = document.getElementById('date').value;
            const description = document.getElementById('description').value;

            // Create expense 
            const expense = {
                amount: parseFloat(amount),
                category: category,
                date: new Date(date),
                description: description
            };

            // Add  expense
            expenses.push(expense);
            displayExpenses();
            updateCategoryChart();
            updateMonthChart();
            resetForm();
        });

        // Display the list of expenses in a table
        function displayExpenses() {
            const expenseList = document.getElementById('expenseList').getElementsByTagName('tbody')[0];
            expenseList.innerHTML = ''; // Clear the list first
            expenses.forEach((expense, index) => {
                const row = expenseList.insertRow();
                row.innerHTML = `
                    <td>${expense.amount}</td>
                    <td>${expense.category}</td>
                    <td>${expense.date.toLocaleDateString()}</td>
                    <td>${expense.description}</td>
                    <td>
                        <button class="btn btn-warning" onclick="editExpense(${index})">Edit</button>
                        <button class="btn btn-danger" onclick="deleteExpense(${index})">Delete</button>
                    </td>
                `;
            });
        }

        // Edit expense it is a  modal
        function editExpense(index) {
            const expense = expenses[index];
            document.getElementById('editAmount').value = expense.amount;
            document.getElementById('editCategory').value = expense.category;
            document.getElementById('editDate').value = expense.date.toISOString().split('T')[0];
            document.getElementById('editDescription').value = expense.description;

            //  editing index to update
            editingIndex = index;
            const modal = new bootstrap.Modal(document.getElementById('editExpenseModal'));
            modal.show();

            // Handle modal form submission
            document.getElementById('editExpenseForm').onsubmit = function (e) {
                e.preventDefault();
                updateExpense(index);
                modal.hide();
            };
        }

        // Update expense in the list
        function updateExpense(index) {
            const amount = document.getElementById('editAmount').value;
            const category = document.getElementById('editCategory').value;
            const date = document.getElementById('editDate').value;
            const description = document.getElementById('editDescription').value;

            expenses[index] = {
                amount: parseFloat(amount),
                category: category,
                date: new Date(date),
                description: description
            };

            displayExpenses();
            updateCategoryChart();
            updateMonthChart();
        }

        // Delete expense functionality
        function deleteExpense(index) {
            expenses.splice(index, 1);
            displayExpenses();
            updateCategoryChart();
            updateMonthChart();
        }

        // Reset the form after adding or editing
        function resetForm() {
            document.getElementById('expenseForm').reset();
        }

        // Update the category-based pie chart
        function updateCategoryChart() {
            let categorySummary = {};

            // Group expenses by category
            expenses.forEach(expense => {
                if (!categorySummary[expense.category]) {
                    categorySummary[expense.category] = 0;
                }
                categorySummary[expense.category] += expense.amount;
            });

            // Prepare data for the chart
            const categories = Object.keys(categorySummary);
            const amounts = categories.map(category => categorySummary[category]);

            // If the chart already exists, destroy it to reset
            if (expenseCategoryChart) {
                expenseCategoryChart.destroy();
            }

            const ctx = document.getElementById('expenseCategoryChart').getContext('2d');
            expenseCategoryChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: categories,
                    datasets: [{
                        label: 'Expense Distribution',
                        data: amounts,
                        backgroundColor: ['#ff9999', '#66b3ff', '#99ff99', '#ffcc99'],
                        borderColor: ['#fff', '#fff', '#fff', '#fff'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function (tooltipItem) {
                                    return tooltipItem.label + ': $' + tooltipItem.raw.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update the monthly bar chart
        function updateMonthChart() {
            let monthSummary = {};

            // Group expenses by month and year
            expenses.forEach(expense => {
                const monthYear = `${expense.date.getMonth() + 1}-${expense.date.getFullYear()}`;
                if (!monthSummary[monthYear]) {
                    monthSummary[monthYear] = 0;
                }
                monthSummary[monthYear] += expense.amount;
            });

            // Prepare data for the chart
            const monthYears = Object.keys(monthSummary);
            const amounts = monthYears.map(monthYear => monthSummary[monthYear]);

            // If the chart already exists, destroy it to reset
            if (expenseMonthChart) {
                expenseMonthChart.destroy();
            }

            const ctx = document.getElementById('expenseMonthChart').getContext('2d');
            expenseMonthChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: monthYears,
                    datasets: [{
                        label: 'Monthly Expenses',
                        data: amounts,
                        backgroundColor: '#66b3ff',
                        borderColor: '#fff',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function (tooltipItem) {
                                    return tooltipItem.label + ': $' + tooltipItem.raw.toFixed(2);
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>
